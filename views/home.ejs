<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URL Customizer</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <section><% for(let i=0; i<600; i++) { %> <span></span> <% } %></section>

    <div class="dashboard-container">
      <h1 class="dash-title" style="text-align: center">URL Customizer</h1>

      <div
        class="signin"
        style="margin: 0 auto 40px; width: 100%; max-width: 600px"
      >
        <div class="content">
          <form action="/submit" method="post" class="form">
            <h2>Generate Link</h2>
            <div class="inputBox">
              <input name="url" type="url" required />
              <i>Original URL</i>
            </div>
            <div class="inputBox">
              <input name="shortcode" type="text" />
              <i>Unique Code (Optional)</i>
            </div>
            <div class="inputBox">
              <input type="submit" value="Generate" />
            </div>
          </form>
        </div>
      </div>

      <h2 class="dash-title" style="font-size: 1.5em; text-align: center">
        Customized Links
      </h2>

      <div class="table-wrapper">
        <% if (allLinks && allLinks.length > 0) { %>
        <div class="scroll-container">
          <table>
            <thead>
              <tr>
                <th>Custom Url</th>
                <th>Custom code</th>
                <th>Long URL</th>
                <th>Total Click</th>
                <th>Last Clicked</th>
                <th>Copy</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < allLinks.length; i++) { const
              shortUrlWithUsername =
              `${baseUrl}/${username}/${allLinks[i].short_code}`; %>
              <tr>
                <td data-label="Short Url" style="border-right: none">
                  <a href="<%= shortUrlWithUsername %>" target="_blank"
                    ><%= shortUrlWithUsername %></a
                  >
                </td>
                <td data-label="Short code"><%= allLinks[i].short_code %></td>
                <td data-label="Long URL" class="url-text">
                  <%= allLinks[i].long_url %>
                </td>
                <td data-label="Total Click"><%= allLinks[i].click_count %></td>
                <td data-label="Last Clicked">
                  <%= String(allLinks[i].last_clicked).split('GMT')[0] %>
                </td>
                <td data-label="Copy">
                  <button
                    class="icon-btn"
                    onclick="copyToClipboard('<%= shortUrlWithUsername %>')"
                  >
                    <img
                      src="/images/copy button.png"
                      style="
                        background-color: white;
                        height: 50px;
                        width: 50px;
                        border-radius: 25px;
                        border: 1px solid black;
                      "
                    />
                  </button>
                </td>
                <td data-label="Delete">
                  <form
                    action="/delete/<%= username %>/<%= allLinks[i].short_code %>"
                    method="POST"
                    onsubmit="return confirm('Are you sure?');"
                    style="display: inline"
                  >
                    <button class="icon-btn delete-btn" type="submit">
                      <img
                        src="/images/delete button.png"
                        style="
                          background-color: white;
                          height: 40px;
                          width: 40px;
                          border-radius: 25px;
                          border: 1px solid black;
                        "
                      />
                    </button>
                  </form>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } else { %>
        <p
          class="no-data"
          style="text-align: center; color: #888; padding: 20px"
        >
          No links found yet. Submit one above!
        </p>
        <% } %>
      </div>
    </div>

    <script>
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("Copied to clipboard: " + text);
          })
          .catch(() => {
            alert("Failed to copy text");
          });
      }
    </script>
  </body>
</html>
