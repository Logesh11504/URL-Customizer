<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1 class="title">URL SHORTENER</h1>
    <form action="/submit" method="post">
        <div class = "input-glass">
            <div class = "input">
                <label>URL</label>
                <input name="url", type="url" placeholder="Type or Paste URL" required>
            </div>
            <div class = "input">
                <label>Short Code</label>
                <input name="shortcode", type="text" placeholder="Optional">
            </div>
            <button type="submit">Generate</button>
        </div>
    </form>
    <h1 class="dashboard">Shortened Links</h1>

    <% if (allLinks && allLinks.length > 0) { %>
        <div class="scroll-container">
            <table>
                <% if (allLinks && allLinks.length > 0) { %>
        Â  Â  Â  Â  <div class="scroll-container">
                    <table>
                        <tr>
                            <td>Short Url</td>
                            <td>Short code</td>
                            <td>Long URL</td>
                            <td>Total Click</td>
                            <td>Last Clicked</td>
                            <td>Copy URL</td>
                            <td>Delete URL</td> Â  Â  Â  Â  Â  Â  Â  Â  
                        </tr>
                        <% for (let i = 0; i < allLinks.length; i++) { %>
                            <% 
                                // **Construct the new short URL here**
                                const shortUrlWithUsername = `${baseUrl}/${username}/${allLinks[i].short_code}`; 
                            %>
                        <tr>
                            <td data-label="Short Url"><a href = "<%= shortUrlWithUsername %>"><%= shortUrlWithUsername %></a></td>
                            <td data-label="Short Code"><%= allLinks[i].short_code %></td>
                            <td data-label="Long URL"><%= allLinks[i].long_url %></td>
                            <td data-label="Total Click"><%= allLinks[i].click_count %></td>
                            <td data-label="Last Clicked"><%= String(allLinks[i].last_clicked) %></td>
                            <td data-label="Copy URL">
                                <button class="icon" onclick="copyToClipboard('<%= shortUrlWithUsername %>')" title="Copy URL">ğŸ“‹</button>
                            </td>
                            <td data-label="Delete URL">
                                <form action="/delete/<%= username %>/<%= allLinks[i].short_code %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this URL?');">
                                    <button class="icon" type="submit" title="Delete URL">ğŸ—‘ï¸</button>
                                </form>
                            </td>
                        </tr>
                    <% } %>
                    </table>
                </div>
            <% } else { %>
                <p class="no-dashboard">No links found yet. Submit one above!</p>
            <% } %>
            </table>
        </div>
    <% } else { %>
        <p class="no-dashboard">No links found yet. Submit one above!</p>
    <% } %>

</body>
<script>
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard: ' + text);
      }).catch(() => {
        alert('Failed to copy text');
      });
    }
  </script>
</html>